# üéØ –†–µ–∑—é–º–µ: DEALRec –¥–ª—è –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã—Ö –î–∞–Ω–Ω—ã—Ö

## ÔøΩÔøΩ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

–ü—Ä–æ–µ–∫—Ç DEALRec_TRX –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Parquet. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–æ–ª–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω –æ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–æ –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —ç–º–±–µ–¥–∏–Ω–≥–æ–≤.

## –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö (`transaction_data_processor.py`)
- –ß—Ç–µ–Ω–∏–µ parquet-—Ñ–∞–π–ª–æ–≤
- –°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–æ–≤–∞—Ä–µ–π –∏ –º–∞–ø–ø–∏–Ω–≥–æ–≤
- –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è LLM
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ

### 2. –û–±—Ä–µ–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö (`transaction_prune.py`)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ SASRec –∫–∞–∫ —Å—É—Ä—Ä–æ–≥–∞—Ç–Ω–æ–π –º–æ–¥–µ–ª–∏
- –í—ã—á–∏—Å–ª–µ–Ω–∏–µ influence –∏ effort scores
- DEALRec-–º–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è –æ—Ç–±–æ—Ä–∞ –æ–±—Ä–∞–∑—Ü–æ–≤
- –°–æ–∑–¥–∞–Ω–∏–µ few-shot –≤—ã–±–æ—Ä–∫–∏

### 3. –î–æ–æ–±—É—á–µ–Ω–∏–µ LLM (`transaction_finetune.py`)
- LoRA fine-tuning –¥–ª—è next token prediction
- –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏

### 4. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —ç–º–±–µ–¥–∏–Ω–≥–æ–≤ (`extract_embeddings.py`)
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–≥–æ—Å–ª–æ–π–Ω—ã—Ö —ç–º–±–µ–¥–∏–Ω–≥–æ–≤
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö –¥–∞—Ç–∞—Å–µ—Ç–æ–≤

### 5. –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ (`transaction_evaluate.py`) ‚≠ê **–ù–û–í–û–ï**
- –ê–Ω–∞–ª–∏–∑ –∫–æ—Å–∏–Ω—É—Å–Ω–æ–≥–æ —Å—Ö–æ–¥—Å—Ç–≤–∞
- –ú–µ—Ç—Ä–∏–∫–∏ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ (Silhouette, Calinski-Harabasz)
- –ê–Ω–∞–ª–∏–∑ –ø–æ —Ü–µ–ª–µ–≤—ã–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º
- t-SNE –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

### **–ü–æ—á–µ–º—É SASRec –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö:**

1. **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–∏—Ä–æ–¥–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** ‚úÖ
   - –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
   - SASRec —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

2. **–í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã** ‚úÖ
   - –ú–æ–¥–µ–ª—å —É–ª–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
   - –£—á–∏—Ç—ã–≤–∞–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã

3. **–ú–Ω–æ–≥–æ–º–µ—Ä–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏** ‚úÖ
   - –†–∞–±–æ—Ç–∞–µ—Ç —Å `event_time`, `amount_rur`, `small_group` –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
   - –ú–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∏–ø–æ–≤ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

4. **Next-item prediction** ‚úÖ
   - –ü—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   - –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ next token prediction –≤ LLM

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### **1. –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:**
```bash
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
python test_data_processing.py

# –ü–æ–ª–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω
sh run_transaction_pipeline.sh "/path/to/your/llm/model" 0.5 25 1024 "0,1,2,3"
```

### **2. –ü–æ—à–∞–≥–æ–≤—ã–π –∑–∞–ø—É—Å–∫:**
```bash
# –®–∞–≥ 1: –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
python code/transaction_data_processor.py

# –®–∞–≥ 2: –û–±—Ä–µ–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
cd code/prune/
sh transaction_prune.sh 0.5 25 1024 0
cd ../../

# –®–∞–≥ 3: –î–æ–æ–±—É—á–µ–Ω–∏–µ LLM
cd code/finetune/
sh transaction_finetune.sh "/path/to/your/llm/model" 1024 "0,1,2,3"
cd ../../

# –®–∞–≥ 4: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —ç–º–±–µ–¥–∏–Ω–≥–æ–≤
python code/finetune/extract_embeddings.py \
    --base_model "/path/to/your/llm/model" \
    --lora_weights ./models/transactions/1024 \
    --parquet_dir train_trx_file.parquet \
    --output_dir embeddings/train
```

## üìä –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

–í–∞—à–∏ Parquet —Ñ–∞–π–ª—ã —Å–æ–¥–µ—Ä–∂–∞—Ç:
- **200 —Ñ–∞–π–ª–æ–≤** –≤ `train_trx_file.parquet/` (~741 —Å—ç–º–ø–ª–æ–≤)
- **100 —Ñ–∞–π–ª–æ–≤** –≤ `test_trx_file.parquet/` (~86 —Å—ç–º–ø–ª–æ–≤)
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞**: `client_id`, `event_time`, `amount_rur`, `small_group`, `target`, `trx_count`

## üìà –í—ã—Ö–æ–¥–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

1. **–û—Ç–æ–±—Ä–∞–Ω–Ω—ã–µ —Å—ç–º–ø–ª—ã**: `code/prune/selected/transactions_1024.pt`
2. **–û–±—É—á–µ–Ω–Ω–∞—è LLM**: `models/transactions/1024/`
3. **–≠–º–±–µ–¥–∏–Ω–≥–∏**: 
   - `embeddings/train/transaction_embeddings.npy`
   - `embeddings/test/transaction_embeddings.npy`

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ–¥—Ö–æ–¥–∞

1. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ 1024 —Å—ç–º–ø–ª–∞ –≤–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞
2. **–ö–∞—á–µ—Å—Ç–≤–æ** - DEALRec –æ—Ç–±–∏—Ä–∞–µ—Ç –Ω–∞–∏–±–æ–ª–µ–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å—ç–º–ø–ª—ã
3. **–ì–∏–±–∫–æ—Å—Ç—å** - –†–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±–æ–π LLM –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π
4. **–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** - –≠–º–±–µ–¥–∏–Ω–≥–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
5. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - LoRA –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—É—á–∞—Ç—å –±–æ–ª—å—à–∏–µ –º–æ–¥–µ–ª–∏

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –≤–∞—à–µ–π –º–æ–¥–µ–ª–∏

### **–ó–∞–º–µ–Ω–∏—Ç–µ –ø—É—Ç–∏ –∫ –º–æ–¥–µ–ª–∏:**
```bash
# –í —Å–∫—Ä–∏–ø—Ç–∞—Ö –∑–∞–º–µ–Ω–∏—Ç–µ:
--base_model "/path/to/your/llm/model"
```

### **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã LoRA:**
```python
lora_target_modules = [
    "q_proj",
    "v_proj",
    # –î–æ–±–∞–≤—å—Ç–µ –¥—Ä—É–≥–∏–µ –º–æ–¥—É–ª–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
]
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
DEALRec_TRX/
‚îú‚îÄ‚îÄ code/
‚îÇ   ‚îú‚îÄ‚îÄ transaction_data_processor.py    # ‚úÖ –ù–æ–≤—ã–π
‚îÇ   ‚îú‚îÄ‚îÄ prune/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ transaction_prune.py         # ‚úÖ –ù–æ–≤—ã–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ transaction_prune.sh         # ‚úÖ –ù–æ–≤—ã–π
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...                          # –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏
‚îÇ   ‚îî‚îÄ‚îÄ finetune/
‚îÇ       ‚îú‚îÄ‚îÄ transaction_finetune.py      # ‚úÖ –ù–æ–≤—ã–π
‚îÇ       ‚îú‚îÄ‚îÄ transaction_finetune.sh      # ‚úÖ –ù–æ–≤—ã–π
‚îÇ       ‚îú‚îÄ‚îÄ extract_embeddings.py        # ‚úÖ –ù–æ–≤—ã–π
‚îÇ       ‚îî‚îÄ‚îÄ ...                          # –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏
‚îú‚îÄ‚îÄ data/transactions/                   # ‚úÖ –°–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
‚îú‚îÄ‚îÄ models/transactions/                 # ‚úÖ –°–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
‚îú‚îÄ‚îÄ embeddings/                          # ‚úÖ –°–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
‚îú‚îÄ‚îÄ run_transaction_pipeline.sh          # ‚úÖ –ù–æ–≤—ã–π
‚îú‚îÄ‚îÄ README_TRANSACTIONS.md               # ‚úÖ –ù–æ–≤—ã–π
‚îî‚îÄ‚îÄ test_data_processing.py              # ‚úÖ –ù–æ–≤—ã–π
```

## üéâ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω –¥–ª—è –≤–∞—à–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ—Å—Ç–æ:

1. **–£–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ –≤–∞—à–µ–π LLM –º–æ–¥–µ–ª–∏**
2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç**: `python test_data_processing.py`
3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–∞–π–ø–ª–∞–π–Ω**: `sh run_transaction_pipeline.sh <your_model_path>`

–ü–æ–ª—É—á–∏—Ç–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —ç–º–±–µ–¥–∏–Ω–≥–∏ –¥–ª—è –≤–∞—à–∏—Ö downstream –∑–∞–¥–∞—á! üöÄ 

## üéâ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

‚úÖ **–ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤** –¥–ª—è –æ–±—É—á–µ–Ω–∏—è LLM –Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ü–µ–Ω–∫–æ–π –∫–∞—á–µ—Å—Ç–≤–∞ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö —ç–º–±–µ–¥–∏–Ω–≥–æ–≤. 